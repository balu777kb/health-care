pipeline {
    agent any
    stages {
        stage('git cloned') {
            steps {
                git url: 'https://github.com/balu777kb/health-care.git', branch: "master"
            }
        }
        stage('Build') {
            steps {
                sh "mvn clean package"
            }
        }
      stage('Build Image'){
          steps{
              sh 'docker build -t healthimg .'
              sh 'docker tag healthimg:balu777kb/healthimgbook'
          }
       }
      stage('Docker login and push'){
          steps{
             withCredentials([usernamePassword(CredentialsId: 'docker',passwordVariable: 'PASS',usernameVariable: 'USER')]){
                 sh "echo \$PASS | docker login -u \$USER --password-stdin"
                 sh 'docker push balu777kb/healthimgbook'
                 }
            }
        }
       stage('Deploy'){
           steps{
                   sh 'docker run -itd --name healthimg -p 8090:8090 balu777kb/healthimgbook'
               }
          }    
        } 
           post{
              success{
                  echo 'Pipeline successfully executed!'
              }
            failure{
                 echo 'Pipeline failed'
          }
   }
}       
